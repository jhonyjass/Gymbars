{% extends "index.html" %}
{% block title %} Dashboard {% endblock %}
{% block body %}


<section class="py-3 mb-5">
  <div class="container-fluid px-3 px-md-4">
    <div class="d-flex justify-content-between align-items-center mb-3 mt-4 flex-wrap">
      <h5 class="fw-bold mb-2 mb-md-0">Dashboard</h5>
      <div class="btn-group" role="group">
        <a href="" class="btn btn-dark font-monospace">
          Reportes
        </a>
      </div>
    </div>

    <div class="row gx-3 gy-4">
      <div class="col-12">
        <div class="card widget-card border-light-subtle h-100">
          <div class="card-body">
            <h5 class="card-title">Ingresos por a√±o y mes</h5>
            <div id="graficaIngresosPorMes"></div>
          </div>
        </div>
      </div>

      <div class="col-12 col-lg-6">
        <div class="card widget-card border-light-subtle h-100">
          <div class="card-body">
            <h5 class="card-title">Porcentaje de tipos de pago</h5>
            <div>
              {% for item in porcentajes_tipos_pago %}
              <div class="mb-3">
                <div class="d-flex justify-content-between">
                  <span>
                    {{ item.tipo_pago }}
                  </span>
                  <span>{{ item.porcentaje }}%</span>
                </div>
                <div class="progress">
                  <div class="progress-bar" role="progressbar" style="width: {{ item.porcentaje }}%;"
                    aria-valuenow="{{ item.porcentaje }}" aria-valuemin="0" aria-valuemax="100">
                  </div>
                </div>
              </div>
              {% endfor %}
            </div>
          </div>
        </div>
      </div>

      <div class="col-12 col-lg-6">
        <div class="card widget-card border-light-subtle h-100">
          <div class="card-body">
            <h5 class="card-title">Suscripciones</h5>
            <div class="mb-3">
              {% set total = conteo_suscripciones.activas + conteo_suscripciones.inactivas %}
              {% set porcentaje_activas = (conteo_suscripciones.activas / total * 100) | round(1) %}
              {% set porcentaje_inactivas = (conteo_suscripciones.inactivas / total * 100) | round(1) %}
              <div class="d-flex justify-content-between mb-1">
                <small class="text-success">
                  Activas: {{ conteo_suscripciones.activas }} / {{ porcentaje_activas}}%
                </small>
                <small class="text-danger">
                  Inactivas: {{ conteo_suscripciones.inactivas }} / {{ porcentaje_inactivas}}%
                </small>
              </div>
              <div class="progress-stacked">
                <div class="progress" role="progressbar" style="height: 22px; width: {{ porcentaje_activas }}%;">
                  <div class="progress-bar bg-success" style="height: 22px; width: 100%"></div>
                </div>
                <div class="progress" role="progressbar" style="height: 22px; width: {{ porcentaje_inactivas }}%;">
                  <div class="progress-bar bg-danger" style="height: 22px; width: 100%"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>
</section>



<script>
  var ingresos_mensuales = {{ ingresos_mensuales | tojson }};
</script>



{% endblock %}